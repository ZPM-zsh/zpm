#compdef zpm
#autoload

local -a _1st_arguments
_1st_arguments=(
  'upgrade:Upgrade plugin'
  'load:Load plugin'
  'load-if:Load plugin if condition true'
  'load-if-not:Load plugin if condition false'
)

local -a _ZPM_Plugins_upgradable
_ZPM_Plugins_upgradable=("zpm" ${_ZPM_Plugins[@]})

local -a _ZPM_Plugins_installed
for plugin in "$_ZPM_PLUGIN_DIR/"*---*; do
  local unused=$( basename "$plugin")
  _ZPM_Plugins_installed+=${unused//---/\/}
done

_ZPM_Plugins_loadable=($(
    echo ${_ZPM_Plugins_installed[@]} ${_ZPM_Plugins[@]} | tr ' ' '\n' | sort | uniq -u
))

_arguments \
'*:: :->subcmds' && return 0

if (( CURRENT == 1 )); then
  _describe -t commands "zpm subcommand" _1st_arguments
  return
fi

if (( CURRENT > 1 )); then
  case "$words[1]" in
    u|up|upgrade)
      _describe -t commands "zpm plugins" _ZPM_Plugins_upgradable
    ;;
    l|load|li|load-if|ln|load-if-not)
      _describe -t commands "zpm plugins" _ZPM_Plugins_loadable
    ;;
  esac
fi


return

